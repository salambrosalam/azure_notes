
Azure notes

=================================

Deply and Manage compute resources



Default creating windows VM using azure gui.
B1s size is free for 750 hours per month (if free-tier period)
Windows Server prefer config: (2vcpus, 8GB RAM)

Security group is creating by default with VM (if you will not choose any security group)
Azure Virtual Network - is isolated network on the Azure Cloud

If you have some issues with limits of creating VMs, you have to create request for extension of limit (Microsoft.Compute)


IIS - web server on windows
how to install it using GUI:
>"Add features"
>in section "Server Roles" click on Web Server (IIS)
>add PORT 80 as allowed in network security group (nsg) attached to this VM 
Then just "next" and install :)

In Azure Subscription you should to create your monthly budget and budget alert (for example 80% percents of used budget)

No costs resources: Virtual Network, NSG, Network interface

State of the Virtual Machine:

Types of disks:
>OS disk (Managed Disk -Designed for high availability, all aspects of the disk will be managed by Azure themselves)
>Temporary disk - size varies depending on the instance size, data on the temporary disk is lostu during a maintenance event, data is lost when you redeploy or STOP and START the VM,
you will not LOST your data in case of RESTART VM                  

Azure have a separeted costs of a resource, even if your VM is shutdown you'll pay for disks (of this VM)                                                                                 

SSH tip: pub key is stored on VM, you will get private key for connet and auth on this VM 


Azure Disks:

>Management - You have Azure Managed Disks that are completely managed by Azure
>Virtualized - Its like having physical disks but they are virtualized
>Highly available - Designed with 99.999% availability
>Support - Has support with features such as Availability Zones, Azure Backup etc.

Disk Types:
>Standard HDD - This is ideal for backup environments and non-critical workloads. Max disk size - 32 767 GB, Max throughput - 500MB/s Max IOPS - 2000
>Standard SSD - This is ideal for Web Servers and Dev/Test Environments. Max disk size - 32 767 GB, Max throughput - 750 MB/s, Max IOPS - 6000.
>Premium SSD - This is ideal for Production environments. Max disk size - 32 767 GB, Max throughput - 950 MB/s, Max IOPS - 20 000.
>Ultra Disk - This is ideal for Input/Output instensive workloads - SQL, Oracle databases. Max disk size - 65 536 GB, Max throughput - 4000 MB/s. Max IOPS - 160 000.


Server-Side Disk Encryption:

Your data is automatically encrypted using 256-bit AES Encryption
This protects the data at rest
This is done for Managed disks - OS and data Disks

It's need to if this disk will be stolen, hackers can't get data from disk cause encryption

for example: 
Encryption: SSE (Server-Side Encryption) with PMK (Platform managed key). That means that key to decrypt this key is stored on platform.

You also have option "Customer keys for encryption":
> you can store your keys using "Azure key vault"
to make this:
>create key vault
>create key
>create disk encryption set
>encrypt disk with "disk encryption set"

Azure Disk Encryption:

os Windows (with bit locker) on Linux with DM-Crypt
Encrypt your disk volumes:
>create key in key vault
>open additional settings and enable disks to encrypt (OS and data disks), and choose current key.

IOPS - Input/Output operations per second (read and writes to data, for example from database)
Throughput - Amount of data is being sent to the storage disk at a specified interval (MB per sec)

Disk snapshot:

To make snapshot of disk on Azure:
>Create disk
>click "Create snapshot"

Snapshot it's READ-ONLY disk replica, but you can create disk based on snapshot (for exapmle, you will get data from snapshot on disk based on this snapshot)

Shared Disk:

Azure Shared Disk - This allows a managed disk to be attached to multiple virtual machine, can only enable for PREMIUM and ULTRA disks!

how to make:
>Create "Managed Disk"
>Configure VM's (this should be the same location as this share disk)
>To attach disk, you have to stop VM 

Manage and UnManaged Disks:

Managed disk - you get high availability. Because the data is replicated automatically on different places within Azure Data center.
Un-managed disk - you own disk, not managed by Azure and these disk will be stored in Azure blob's storage and then you can attach disk to the VM.

NOTE: You can't have both managed and un-managed disk with VM

Ok difference in cost. For the managed disk you will pay for all space (for example 128GB), in un-managed disk only for space wich you consumes.

The storage account disk type (premium SSD or standard SSD, HDD) should be the same like a disk for VM

how to make un-managed disk:
>create storage account
>on stage of creating VM, on "Disks" disable managed disks, and enable "Use ephemeral OS disk" and choose storage account

Un-managed disks stored in "vhds container" in storage account

Custom Script Extensions:

This tool can be used on Azure virtual Machines to download and execute scripts.
This is ideal when you want to deploy any custom configuration of any software installation on a virtual machine.
The scripts can be located in an Azure storage account or even on GitHub.
A time duration of 90 minutes is allowed for the script to run. Any longer and the result will be a failed extension provision.
It's ideal not to place reboots inside the scripts, because the extension will not continue after the reboot. Hence if have other commands that need to run via the extension after the reboot, they won't run.
If your scipt does need a reboot, then maybe you can look at other tools such as Desired State Configuration, Chef or Puppet.
The script will run only once.
The Custom Script Extension will run under the impersonation of the LocalSystem Account.

On Windows - PowerShell scripts.
On Linux - Bash scripts 

Cloud init - this is scripts like Script Extensions but in plain text way, you should not download script file and with Azure syntax
you could run Azure Scripts, example:

#cloud-config
package_upgrade: true
packages: 
	- nginx

Boot Diagnostics:

This is option to diagnostics for VM (during the time of VM)

Serial Console:

To use this option you have to use "Enable with custom storage account" in Boot diagnostics
Using serial console you could connect to VM using console

Run Command:

Useful option to run some scripts on running VM
 








